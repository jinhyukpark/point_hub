#!/usr/bin/env node

/**
 * Generate firebase-config.js from .env file
 * This script reads environment variables and generates a config file
 * 
 * Usage:
 *   node scripts/generate-firebase-config.js
 *   or
 *   npm run generate:config
 */

const fs = require('fs');
const path = require('path');

// Try to load dotenv if available
try {
  require('dotenv').config();
} catch (e) {
  console.warn('dotenv not found. Install it with: npm install --save-dev dotenv');
}

const configPath = path.join(__dirname, '../public/firebase-config.js');

// Read from environment variables or use defaults
const config = {
  apiKey: process.env.VITE_FIREBASE_API_KEY || process.env.FIREBASE_API_KEY || '',
  authDomain: process.env.VITE_FIREBASE_AUTH_DOMAIN || process.env.FIREBASE_AUTH_DOMAIN || '',
  databaseURL: process.env.VITE_FIREBASE_DATABASE_URL || process.env.FIREBASE_DATABASE_URL || '',
  projectId: process.env.VITE_FIREBASE_PROJECT_ID || process.env.FIREBASE_PROJECT_ID || '',
  storageBucket: process.env.VITE_FIREBASE_STORAGE_BUCKET || process.env.FIREBASE_STORAGE_BUCKET || '',
  messagingSenderId: process.env.VITE_FIREBASE_MESSAGING_SENDER_ID || process.env.FIREBASE_MESSAGING_SENDER_ID || '',
  appId: process.env.VITE_FIREBASE_APP_ID || process.env.FIREBASE_APP_ID || '',
  measurementId: process.env.VITE_FIREBASE_MEASUREMENT_ID || process.env.FIREBASE_MEASUREMENT_ID || ''
};

// Check if all values are provided
const missingVars = Object.entries(config)
  .filter(([key, value]) => !value)
  .map(([key]) => key);

if (missingVars.length > 0) {
  console.warn('‚ö†Ô∏è  Warning: Missing environment variables:', missingVars.join(', '));
  console.warn('   Using default values. Create a .env file with your Firebase config.');
}

const configFile = `// Firebase Configuration
// This file is auto-generated from .env file
// DO NOT EDIT THIS FILE MANUALLY - Run 'npm run generate:config' to regenerate
//
// To use environment variables:
// 1. Create a .env file in the root directory
// 2. Add your Firebase config values (see .env.example)
// 3. Run 'npm run generate:config' to regenerate this file

(function() {
  'use strict';

  // Production Firebase config
  const productionConfig = ${JSON.stringify(config, null, 2)};

  // Check if running on localhost (emulator mode)
  const isLocalhost = window.location.hostname === 'localhost' ||
                      window.location.hostname === '127.0.0.1' ||
                      window.location.port === '8080';

  // Emulator configuration
  const emulatorConfig = {
    auth: { host: '127.0.0.1', port: 9099 },
    database: { host: '127.0.0.1', port: 9000 },
    functions: { host: '127.0.0.1', port: 5001 }
  };

  // Use emulator database URL when on localhost
  if (isLocalhost) {
    window.firebaseConfig = {
      ...productionConfig,
      databaseURL: 'http://127.0.0.1:9000?ns=point-hub-a9db1'
    };
    window.useEmulators = true;
    window.emulatorConfig = emulatorConfig;
    console.log('üîß Development mode: Using Firebase Emulators');
  } else {
    window.firebaseConfig = productionConfig;
    window.useEmulators = false;
    window.emulatorConfig = null;
    console.log('üöÄ Production mode: Using Firebase Production');
  }
})();
`;

fs.writeFileSync(configPath, configFile, 'utf8');
console.log('‚úÖ firebase-config.js generated successfully from .env file');

